<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración Gimnasio</title>
    <script src="https://cdn.tailwindcss.com"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css"> 
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 sm:p-12 rounded-xl shadow-2xl w-full max-w-md">
        <div id="welcomeMessage" class="text-center mb-6 hidden">
            <p class="text-xl text-gray-700">Bienvenido/a, <strong id="managerName" class="text-blue-600"></strong>!</p>
        </div>
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-10">Gimnasio XYZ</h1>
        
        <div id="publicOptions" class="space-y-5">
            <a href="control_acceso.html" class="block text-center bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Control de Acceso</a>
            <!-- El botón de Iniciar Sesión se añade aquí por JavaScript -->
        </div>

        <div id="adminOptions" class="space-y-5 mt-5 hidden">
            <h2 class="text-xl font-semibold text-gray-700 text-center border-b pb-2 mb-4">Panel de Administración</h2>
            <a href="registro_miembro.html" class="admin-button block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Registro de Miembros</a>
            <a href="registro_gerente.html" class="admin-button block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Registro Gerente</a>
            <a href="gestionar_miembros.html" class="admin-button block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Gestionar Miembros</a>
            <a href="gestionar_gerentes.html" class="admin-button block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Gestionar Gerentes</a>
            <a href="reporte_acceso.html" class="admin-button block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg">Reporte de Acceso</a>
        </div>

        <div id="sessionControls" class="mt-8">
            <!-- El botón de Iniciar/Cerrar Sesión se generará dinámicamente -->
        </div>
    </div>

    <script src="../js/utils.js"></script> 
    <script>
        const publicOptions = document.getElementById('publicOptions');
        const adminOptions = document.getElementById('adminOptions');
        const sessionControls = document.getElementById('sessionControls');
        const welcomeMessageDiv = document.getElementById('welcomeMessage');
        const managerNameSpan = document.getElementById('managerName');

        console.log("[Index.html] Script cargado. Elementos iniciales:", {publicOptions, adminOptions, sessionControls, welcomeMessageDiv, managerNameSpan});

        function updateUIBasedOnSession() {
            console.log("[Index.html] updateUIBasedOnSession() llamada.");
            const gerenteSessionData = localStorage.getItem('gerenteSession');
            console.log("[Index.html] gerenteSessionData de localStorage:", gerenteSessionData);
            
            if (gerenteSessionData) {
                try {
                    const gerente = JSON.parse(gerenteSessionData);
                    console.log("[Index.html] Sesión de gerente encontrada y parseada:", gerente);
                    // Usuario está logueado
                    if(adminOptions) adminOptions.classList.remove('hidden');
                    if(welcomeMessageDiv && managerNameSpan) {
                        managerNameSpan.textContent = gerente.nombre || gerente.correo || 'Gerente';
                        welcomeMessageDiv.classList.remove('hidden');
                    }
                    
                    if(sessionControls) {
                        console.log("[Index.html] Configurando botón de Cerrar Sesión.");
                        sessionControls.innerHTML = `
                            <button id="btnLogout" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out text-lg">
                                Cerrar Sesión
                            </button>`;
                        document.getElementById('btnLogout')?.addEventListener('click', () => {
                            console.log("[Index.html] Botón Cerrar Sesión clickeado.");
                            localStorage.removeItem('gerenteSession');
                            showNotification('Sesión cerrada.', 'info');
                            setTimeout(() => window.location.reload(), 1500); 
                        });
                    }
                    // Eliminar el botón de login si existe en publicOptions
                    const existingLoginButton = publicOptions?.querySelector('a[href="login_gerente.html"]');
                    if (existingLoginButton) {
                        console.log("[Index.html] Eliminando botón de Iniciar Sesión existente de publicOptions.");
                        existingLoginButton.remove();
                    }

                } catch (e) {
                    console.error("[Index.html] Error al parsear datos de sesión del gerente:", e);
                    localStorage.removeItem('gerenteSession'); 
                    setupLoginButton(); // Configurar UI para estado no logueado
                }
            } else {
                // Usuario no está logueado
                console.log("[Index.html] No hay sesión de gerente. Configurando para estado no logueado.");
                if(adminOptions) adminOptions.classList.add('hidden');
                if(welcomeMessageDiv) welcomeMessageDiv.classList.add('hidden');
                setupLoginButton();
            }
        }

        function setupLoginButton() {
            console.log("[Index.html] setupLoginButton() llamada.");
             if(publicOptions && sessionControls) { 
                // Asegurar que el área de control de sesión (logout) esté vacía
                sessionControls.innerHTML = ''; 
                
                // Añadir botón de Iniciar Sesión a publicOptions si no existe
                if (!publicOptions.querySelector('a[href="login_gerente.html"]')) {
                    console.log("[Index.html] Creando y añadiendo botón de Iniciar Sesión a publicOptions.");
                    const loginLink = document.createElement('a');
                    loginLink.href = 'login_gerente.html';
                    loginLink.className = 'block text-center bg-gray-700 hover:bg-gray-800 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out w-full text-lg mt-5';
                    loginLink.textContent = 'Iniciar Sesión (Gerente)';
                    publicOptions.appendChild(loginLink);
                } else {
                    console.log("[Index.html] Botón de Iniciar Sesión ya existe en publicOptions.");
                }
            } else {
                console.error("[Index.html] Error en setupLoginButton: publicOptions o sessionControls no encontrados.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("[Index.html] DOMContentLoaded - llamando a updateUIBasedOnSession.");
            updateUIBasedOnSession();
        });
    </script>
</body>
</html>
